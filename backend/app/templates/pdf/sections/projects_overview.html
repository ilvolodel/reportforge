<!-- PROJECTS OVERVIEW -->
<div class="page-break"></div>

<h2>Panoramica Progetti</h2>

{% if projects %}
<p class="text-muted mb-2">
    Report include {{ projects|length }} progetti attivi nel periodo {{ report.period_start.strftime('%B %Y')|capitalize }}.
</p>

<table>
    <thead>
        <tr>
            <th>Nome Progetto</th>
            <th>Categoria</th>
            <th>Stakeholder</th>
            <th class="text-center">Status</th>
            <th class="text-center">Data Inizio</th>
        </tr>
    </thead>
    <tbody>
        {% for project in projects %}
        <tr>
            <td><strong>{{ project.name }}</strong></td>
            <td>{{ project.category or '-' }}</td>
            <td class="text-small">
                {% if project.stakeholders %}
                {{ project.stakeholders[:3]|join(', ') }}
                {% if project.stakeholders|length > 3 %}
                <span class="text-muted"> +{{ project.stakeholders|length - 3 }} altri</span>
                {% endif %}
                {% else %}
                -
                {% endif %}
            </td>
            <td class="text-center">
                {% set status_class = 'status-active' %}
                {% if project.status == 'Completed' %}
                    {% set status_class = 'status-completed' %}
                {% elif project.status == 'Planning' %}
                    {% set status_class = 'status-planning' %}
                {% elif project.status == 'On Hold' %}
                    {% set status_class = 'status-on-hold' %}
                {% elif project.status == 'Cancelled' %}
                    {% set status_class = 'status-cancelled' %}
                {% endif %}
                <span class="status-badge {{ status_class }}">
                    {{ project.status or 'Active' }}
                </span>
            </td>
            <td class="text-center text-small">
                {% if project.start_date %}
                {{ project.start_date.strftime('%m/%Y') }}
                {% else %}
                -
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Projects by Category -->
{% set categories = projects|map(attribute='category')|unique|list %}
{% if categories|length > 1 %}
<div class="mb-2">
    <h3>Distribuzione per Categoria</h3>
    <ul class="no-bullets">
        {% for category in categories if category %}
        {% set cat_projects = projects|selectattr('category', 'equalto', category)|list %}
        <li>
            <strong>{{ category }}</strong>: {{ cat_projects|length }} progett{{ 'o' if cat_projects|length == 1 else 'i' }}
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{% else %}
<p class="text-muted">Nessun progetto disponibile per questo report.</p>
{% endif %}
